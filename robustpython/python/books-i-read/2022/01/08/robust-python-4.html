<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Different ways to constrain types in Python | mlops.systems</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Different ways to constrain types in Python" />
<meta name="author" content="Alex Strick van Linschoten" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Reflections on the fourth chapter of Patrick Viafore’s recent book, ‘Robust Python’. We learn about the different options for combining types and constraining exactly which sets of types are permitted for a particular function or variable signature." />
<meta property="og:description" content="Reflections on the fourth chapter of Patrick Viafore’s recent book, ‘Robust Python’. We learn about the different options for combining types and constraining exactly which sets of types are permitted for a particular function or variable signature." />
<link rel="canonical" href="https://mlops.systems/robustpython/python/books-i-read/2022/01/08/robust-python-4.html" />
<meta property="og:url" content="https://mlops.systems/robustpython/python/books-i-read/2022/01/08/robust-python-4.html" />
<meta property="og:site_name" content="mlops.systems" />
<meta property="og:image" content="https://mlops.systems/images/robust-python/robust-python-cover.jpeg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-01-08T00:00:00-06:00" />
<script type="application/ld+json">
{"datePublished":"2022-01-08T00:00:00-06:00","url":"https://mlops.systems/robustpython/python/books-i-read/2022/01/08/robust-python-4.html","@type":"BlogPosting","dateModified":"2022-01-08T00:00:00-06:00","image":"https://mlops.systems/images/robust-python/robust-python-cover.jpeg","mainEntityOfPage":{"@type":"WebPage","@id":"https://mlops.systems/robustpython/python/books-i-read/2022/01/08/robust-python-4.html"},"author":{"@type":"Person","name":"Alex Strick van Linschoten"},"headline":"Different ways to constrain types in Python","description":"Reflections on the fourth chapter of Patrick Viafore’s recent book, ‘Robust Python’. We learn about the different options for combining types and constraining exactly which sets of types are permitted for a particular function or variable signature.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://mlops.systems/feed.xml" title="mlops.systems" /><!-- the google_analytics_id gets auto inserted from the config file -->



<script
  defer
  data-domain="mlops.systems"
  src="https://plausible.io/js/plausible.js"
></script>


<link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />

<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">mlops.systems</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About Me</a><a class="page-link" href="/search/">Search</a><a class="page-link" href="/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Different ways to constrain types in Python</h1><p class="page-description">Reflections on the fourth chapter of Patrick Viafore's recent book, 'Robust Python'. We learn about the different options for combining types and constraining exactly which sets of types are permitted for a particular function or variable signature.</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2022-01-08T00:00:00-06:00" itemprop="datePublished">
        Jan 8, 2022
      </time>• 
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name">Alex Strick van Linschoten</span></span>
       • <span class="read-time" title="Estimated read time">
    
    
      3 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/categories/#robustpython">robustpython</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#python">python</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#books-i-read">books-i-read</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#optional-to-catch-none-references">Optional to catch None references</a></li>
<li class="toc-entry toc-h2"><a href="#union-to-group-types-together">Union to group types together</a></li>
<li class="toc-entry toc-h2"><a href="#literal-to-include-only-specific-values">Literal to include only specific values</a></li>
<li class="toc-entry toc-h2"><a href="#annotated-for-more-complicated-restrictions">Annotated for more complicated restrictions</a></li>
<li class="toc-entry toc-h2"><a href="#newtype-to-cover-different-contexts-applied-to-the-same-type">NewType to cover different contexts applied to the same type</a></li>
<li class="toc-entry toc-h2"><a href="#final-to-prevent-reassignment--rebinding">Final to prevent reassignment / rebinding</a></li>
</ul><p>The fourth chapter of <a href="https://www.amazon.com/Robust-Python-Patrick-Viafore-ebook-dp-B09982C9FX/dp/B09982C9FX/ref=mt_other?_encoding=UTF8&amp;me=&amp;tag=soumet-20&amp;qid=">‘Robust Python’</a> continues on from <a href="https://mlops.systems/robustpython/python/books-i-read/2022/01/03/robust-python-3.html">where we left off</a> last time. We had previously learned about the benefits of type annotations in general terms, as well as started to understand how we might apply these annotations to simple code examples. But what if things are a bit more complicated? Then we have a few more options at our disposal.</p>

<p>Note that you can assign all of these type assignments to variables (‘type aliases’), which might just make your code that much more readable.</p>

<h2 id="optional-to-catch-none-references">
<a class="anchor" href="#optional-to-catch-none-references" aria-hidden="true"><span class="octicon octicon-link"></span></a><code class="language-plaintext highlighter-rouge">Optional</code> to catch <code class="language-plaintext highlighter-rouge">None</code> references</h2>

<p><code class="language-plaintext highlighter-rouge">Optional</code> as a type annotation is where you want to allow a specific type or <code class="language-plaintext highlighter-rouge">None</code> to be passed in to a particular function:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>

<span class="k">def</span> <span class="nf">some_function</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
	<span class="c1"># your code goes here
</span></code></pre></div></div>

<p>Note that you’ll probably want (and <code class="language-plaintext highlighter-rouge">mypy</code> will remind you if you forget) to handle what happens in both those cases inside your function. (You may need to specifically pass in the <code class="language-plaintext highlighter-rouge">—strict-optional</code> flag to catch this when using <code class="language-plaintext highlighter-rouge">mypy</code>.)</p>

<h2 id="union-to-group-types-together">
<a class="anchor" href="#union-to-group-types-together" aria-hidden="true"><span class="octicon octicon-link"></span></a><code class="language-plaintext highlighter-rouge">Union</code> to group types together</h2>

<p>This is used when multiple different types can be used for the same variable:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span>

<span class="k">def</span> <span class="nf">returns_the_input</span><span class="p">(</span><span class="nb">input</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
	<span class="k">return</span> <span class="nb">input</span>
</code></pre></div></div>

<p>This function doesn’t really do anything, but you get the idea. Note, too, that <code class="language-plaintext highlighter-rouge">Optional[int]</code> is really a version of <code class="language-plaintext highlighter-rouge">Union[int, None]</code>. (The book gets into exactly why we might care about reducing the number of possible options by way of a little detour into set theory.)</p>

<h2 id="literal-to-include-only-specific-values">
<a class="anchor" href="#literal-to-include-only-specific-values" aria-hidden="true"><span class="octicon octicon-link"></span></a><code class="language-plaintext highlighter-rouge">Literal</code> to include only specific values</h2>

<p>A little like what I believe enumerations do, we also have the <code class="language-plaintext highlighter-rouge">Literal</code> type. It restricts you to whatever specific values are defined:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Literal</span>

<span class="k">def</span> <span class="nf">some_function</span><span class="p">(</span><span class="nb">input</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
	<span class="k">return</span> <span class="nb">input</span>
</code></pre></div></div>

<p>Here the function is restricted to inputs that are either 1, 2 or 3. Note that these are a feature that applies to Python 3.8 and above.</p>

<h2 id="annotated-for-more-complicated-restrictions">
<a class="anchor" href="#annotated-for-more-complicated-restrictions" aria-hidden="true"><span class="octicon octicon-link"></span></a><code class="language-plaintext highlighter-rouge">Annotated</code> for more complicated restrictions</h2>

<p>These are available, but not really useful since they only function as a communication method. You can specify specific restrictions such as the following (example is taken from the book, p. 56:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Annotated</span>

<span class="n">x</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">ValueRange</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">)]</span>
<span class="n">y</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">MatchesRegex</span><span class="p">(</span><span class="s">'[abc]{2}'</span><span class="p">)</span>
</code></pre></div></div>

<p>Read more about it <a href="https://docs.python.org/3/library/typing.html?highlight=annotated#typing.Annotated">here</a>. The book doesn’t spend much time on it and it seems like it’s probably best left alone for the moment.</p>

<h2 id="newtype-to-cover-different-contexts-applied-to-the-same-type">
<a class="anchor" href="#newtype-to-cover-different-contexts-applied-to-the-same-type" aria-hidden="true"><span class="octicon octicon-link"></span></a><code class="language-plaintext highlighter-rouge">NewType</code> to cover different contexts applied to the same type</h2>

<p><code class="language-plaintext highlighter-rouge">NewType</code>, on the other hand, is quite useful. You can create new types which are identical to some other type, and those new values made with the new type will have access to all the methods and properties as the original type.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">NewType</span>

<span class="k">class</span> <span class="nc">Book</span><span class="p">:</span>
	<span class="c1"># you implement the class here
</span>	
<span class="n">NewBook</span> <span class="o">=</span> <span class="n">NewType</span><span class="p">(</span><span class="s">"NewBook"</span><span class="p">,</span> <span class="n">Book</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">process_new_book</span><span class="p">(</span><span class="n">book</span><span class="p">:</span> <span class="n">NewBook</span><span class="p">):</span>
	<span class="c1"># here you handle what happens to the new book
</span></code></pre></div></div>

<p>You can achieve something like the same thing with classes and inheritance, I believe, but this is a lightweight version which might be useful to achieve the same end goal.</p>

<h2 id="final-to-prevent-reassignment--rebinding">
<a class="anchor" href="#final-to-prevent-reassignment--rebinding" aria-hidden="true"><span class="octicon octicon-link"></span></a><code class="language-plaintext highlighter-rouge">Final</code> to prevent reassignment / rebinding</h2>

<p>You can specify that a particular variable should have a single value and that value only. (Note that mutations of an object etc are all still possible, but reassignment to a new memory address is not possible.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Final</span>

<span class="n">NAME</span><span class="p">:</span> <span class="n">Final</span> <span class="o">=</span> <span class="s">"Alex"</span>
</code></pre></div></div>

<p>If you tried to subsequently change this to a different name, <code class="language-plaintext highlighter-rouge">mypy</code> would catch that you’d tried to do this. This can be valuable across very large codebases, where the potential for someone to reassign a variable might be not insignificant.</p>

<p>So there you have it: a bunch of different ways to handle combinations of types and/or more complicated annotation scenarios. The next chapter will cover what happens when we throw collections into the mix, and what type annotation challenges are raised.</p>

  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="strickvl/ml-blog"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/robustpython/python/books-i-read/2022/01/08/robust-python-4.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>A place to share my technical learnings.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/strickvl" target="_blank" title="strickvl"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/strickvl" target="_blank" title="strickvl"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
